## 概览
- 目标：在当前 XCode/CC 任务完成后，继续跑 HumanEvalET 与 MBPPET；随后切换至 QwenCoder480b，将 MapCoder 在全部数据集全量重跑；最终重构 final-results 为“按模型汇总”的简洁结构，并更新全部图像。

## 阶段A：收尾当前模型（QwenCoderTurbo）
- 完成中的任务：
  - XCode · MapCoder · QwenCoderTurbo（并行4进程）
  - CodeContest · MapCoder · QwenCoderTurbo
- 完成后统一合并与摘要：
  - 合并分片：`python scripts/merge_results.py --dataset XCode --strategy MapCoder --model QwenCoderTurbo --language Python3 --temperature 0.0 --pass_at_k 1 --parts 4 --results_dir results --merged_out results/XCode/QwenCoderTurbo-MapCoder-XCode-Python3-0.0-1-merged.jsonl --summary_out final-results/QwenCoderTurbo/XCode/summary_MapCoder.md`
  - CC 单文件：`python scripts/merge_results.py --dataset CC --strategy MapCoder --model QwenCoderTurbo --language Python3 --temperature 0.0 --pass_at_k 1 --single_path QwenCoderTurbo-MapCoder-CC-Python3-0.0-1-fresh.jsonl --summary_out final-results/QwenCoderTurbo/CC/summary_MapCoder.md`

## 阶段B：生成 ET 结果（QwenCoderTurbo）
- HumanEvalET：
  - 基于合并后的常规结果生成 ET：
    - `python src/evaluate-et-dataset.py --dataset HumanEvalET --strategy MapCoder --model QwenCoderTurbo --language Python3 --temperature 0.0 --pass_at_k 1`
  - 输出：`results/HumanEval/ET/QwenCoderTurbo-MapCoder-HumanEvalET-Python3-0.0-1.jsonl`
- MBPPET：
  - `python src/evaluate-et-dataset.py --dataset MBPPET --strategy MapCoder --model QwenCoderTurbo --language Python3 --temperature 0.0 --pass_at_k 1`
  - 输出：`results/MBPP/QwenCoderTurbo-MapCoder-MBPPET-Python3-0.0-1.jsonl`
- 汇总：
  - 运行 `python scripts/update_results_summaries.py` 刷新 `final-results/QwenCoderTurbo/summary_overview.md` 中的 ET 段落（该脚本会自动从 results 目录解析 metrics）。

## 阶段C：切换模型至 QwenCoder480b 并全量重跑 MapCoder
- HumanEval（单进程示例）：
  - `python src/main.py --dataset HumanEval --strategy MapCoder --model QwenCoder480b --language Python3 --temperature 0.0 --pass_at_k 1 --results-suffix=-fresh --discard-previous-run`
- MBPP/APPS/XCode（并行示例）：
  - `python scripts/run_parallel.py --dataset MBPP --strategy MapCoder --model QwenCoder480b --language Python3 --temperature 0.0 --pass_at_k 1 --processes 4 --discard-previous-run`
  - `python scripts/run_parallel.py --dataset APPS --strategy MapCoder --model QwenCoder480b --language Python3 --temperature 0.0 --pass_at_k 1 --processes 4 --discard-previous-run`
  - `python scripts/run_parallel.py --dataset XCode --strategy MapCoder --model QwenCoder480b --language Python3 --temperature 0.0 --pass_at_k 1 --processes 4 --discard-previous-run`
- CodeContest（单进程）：
  - `python src/main.py --dataset CC --strategy MapCoder --model QwenCoder480b --language Python3 --temperature 0.0 --pass_at_k 1 --results-suffix=-fresh --discard-previous-run`
- 合并与摘要：
  - 使用 `scripts/merge_results.py` 按数据集写入 `results/<Dataset>/<RUN_NAME>-merged.jsonl`；摘要写至 `final-results/QwenCoder480b/<Dataset>/summary_MapCoder.md`（临时结构，用于生成总览）。
- 480b 的 ET：
  - 人类评测扩展（批量脚本现成）：`python scripts/gen_et_480b_batch.py`
  - MBPPET：`python src/evaluate-et-dataset.py --dataset MBPPET --strategy MapCoder --model QwenCoder480b --language Python3 --temperature 0.0 --pass_at_k 1`

## 阶段D：final-results 目录重构（按模型聚合）
- 生成模型级总览（覆盖现有）：
  - `python scripts/generate_model_overview.py --models QwenCoderTurbo QwenCoder480b`
  - 产出：`final-results/QwenCoderTurbo/summary_overview.md`、`final-results/QwenCoder480b/summary_overview.md`，包含各数据集 MapCoder（及其他策略，如有）汇总指标与来源路径。
- 目录调整方案：
  - 保留每模型目录：`final-results/QwenCoderTurbo/`、`final-results/QwenCoder480b/`
  - 仅保留：`summary_overview.md`
  - 可选保留：每策略-每数据集摘要（如 `summary_MapCoder.md`）仅在需要深入分析时保留；否则移至 `archive/` 以简化结构。
  - 注：图像生成脚本可从 `results/*-merged.jsonl` 或 `summary_overview.md` 读取，无需保留数据集子目录；若需要，我会在生成图像前确认脚本读取来源。

## 阶段E：图像更新
- 运行：`python scripts/generate_progress_charts.py`
- 输出位置：`images/progress/Compare/*.png`、`images/progress/QwenCoderTurbo/*.png`、`images/progress/QwenCoder480b/*.png`
- 脚本会自动清理过期 PNG 并覆盖生成；若目录结构简化后缺失单独摘要，脚本将回退从 `results/*-merged.jsonl` 汇总。

## 成功标准
- 所有数据集（Turbo 与 480b）MapCoder 重跑完成，合并文件存在且指标可读。
- HumanEvalET/MBPPET 生成完成并出现在对应 `results` 目录；总览页包含 ET 段落。
- `final-results/<Model>/summary_overview.md` 成为唯一权威总览，结构简洁。
- `images/progress` 下的对比与模型策略图全部更新。

## 资源与耗时
- 大数据集（MBPP、APPS、XCode）耗时较长；并行建议 4–8 进程，按机器资源调整。
- ET 生成基于已有合并结果，速度较快（纯本地评测与写入）。

## 风险与缓解
- Windows 下参数传递需用 `--results-suffix=-fresh` 格式；并行脚本不支持该参数。
- 数据切分缺失（APPS 先前出现 139 vs 140）：合并时会提示缺失分片；最终指标以已合并总数为准。
- 目录重构可能影响图像脚本的默认读取路径；如检测到缺失，我将让脚本仅依赖 `results/*-merged.jsonl` 与每模型 `summary_overview.md`。