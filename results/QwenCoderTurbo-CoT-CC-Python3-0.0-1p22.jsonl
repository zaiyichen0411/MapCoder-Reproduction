{"name": "1580_B. Mathematics Curriculum", "description": "Let c_1, c_2, \u2026, c_n be a permutation of integers 1, 2, \u2026, n. Consider all subsegments of this permutation containing an integer x. Given an integer m, we call the integer x good if there are exactly m different values of maximum on these subsegments.\n\nCirno is studying mathematics, and the teacher asks her to count the number of permutations of length n with exactly k good numbers.\n\nUnfortunately, Cirno isn't good at mathematics, and she can't answer this question. Therefore, she asks you for help.\n\nSince the answer may be very big, you only need to tell her the number of permutations modulo p.\n\nA permutation is an array consisting of n distinct integers from 1 to n in arbitrary order. For example, [2,3,1,5,4] is a permutation, but [1,2,2] is not a permutation (2 appears twice in the array) and [1,3,4] is also not a permutation (n=3 but there is 4 in the array).\n\nA sequence a is a subsegment of a sequence b if a can be obtained from b by deletion of several (possibly, zero or all) elements from the beginning and several (possibly, zero or all) elements from the end.\n\nInput\n\nThe first line contains four integers n, m, k, p (1 \u2264 n \u2264 100, 1 \u2264 m \u2264 n, 1 \u2264 k \u2264 n, 1 \u2264 p \u2264 10^9).\n\nOutput\n\nOutput the number of permutations modulo p.\n\nExamples\n\nInput\n\n\n4 3 2 10007\n\n\nOutput\n\n\n4\n\n\nInput\n\n\n6 4 1 769626776\n\n\nOutput\n\n\n472\n\n\nInput\n\n\n66 11 9 786747482\n\n\nOutput\n\n\n206331312\n\n\nInput\n\n\n99 30 18 650457567\n\n\nOutput\n\n\n77365367\n\nNote\n\nIn the first test case, there are four permutations: [1, 3, 2, 4], [2, 3, 1, 4], [4, 1, 3, 2] and [4, 2, 3, 1].\n\nTake permutation [1, 3, 2, 4] as an example:\n\nFor number 1, all subsegments containing it are: [1], [1, 3], [1, 3, 2] and [1, 3, 2, 4], and there're three different maxima 1, 3 and 4.\n\nSimilarly, for number 3, there're two different maxima 3 and 4. For number 2, there're three different maxima 2, 3 and 4. And for number 4, there're only one, that is 4 itself.", "tags": ["brute force", "combinatorics", "dp", "trees"], "difficulty": 8, "id": 1580, "sample_io": [{"input": "6 4 1 769626776\n", "output": ["472\n"]}, {"input": "99 30 18 650457567\n", "output": ["77365367\n"]}, {"input": "66 11 9 786747482\n", "output": ["206331312\n"]}, {"input": "4 3 2 10007\n", "output": ["4\n"]}], "test_list": [{"input": "100 31 30 148365334\n", "output": ["109422564\n"]}, {"input": "87 24 38 728447282\n", "output": ["0\n"]}, {"input": "99 30 18 5\n", "output": ["4\n"]}, {"input": "60 19 17 176391848\n", "output": ["5472856\n"]}, {"input": "100 47 23 833795844\n", "output": ["307365396\n"]}, {"input": "30 14 9 157679620\n", "output": ["108877500\n"]}, {"input": "100 37 30 870664704\n", "output": ["824463360\n"]}, {"input": "100 30 70 1064\n", "output": ["0\n"]}, {"input": "63 20 17 662420638\n", "output": ["601955200\n"]}, {"input": "75 36 9 855650468\n", "output": ["297363408\n"]}, {"input": "100 32 24 438754730\n", "output": ["323005970\n"]}, {"input": "49 15 14 308312578\n", "output": ["286342426\n"]}, {"input": "89 18 15 106840615\n", "output": ["7402302\n"]}, {"input": "54 10 15 221451100\n", "output": ["61500800\n"]}, {"input": "100 30 70 12345\n", "output": ["0\n"]}, {"input": "88 24 25 422257596\n", "output": ["355265832\n"]}, {"input": "100 25 32 164834266\n", "output": ["27258808\n"]}, {"input": "87 18 12 933725311\n", "output": ["182369268\n"]}, {"input": "100 41 33 456754732\n", "output": ["0\n"]}, {"input": "96 28 21 992859620\n", "output": ["385257568\n"]}, {"input": "100 44 16 988511794\n", "output": ["930609868\n"]}, {"input": "18 4 4 205152209\n", "output": ["121181834\n"]}, {"input": "7 3 4 1064\n", "output": ["80\n"]}, {"input": "100 43 28 548072991\n", "output": ["152924211\n"]}, {"input": "96 25 23 965938339\n", "output": ["170691124\n"]}, {"input": "100 54 27 714405093\n", "output": ["0\n"]}, {"input": "100 48 20 426348968\n", "output": ["202656728\n"]}, {"input": "81 14 14 695031561\n", "output": ["655625417\n"]}, {"input": "34 10 3 198747828\n", "output": ["99715064\n"]}, {"input": "100 30 70 4601\n", "output": ["0\n"]}, {"input": "61 19 21 748555616\n", "output": ["223470400\n"]}, {"input": "100 100 100 905987364\n", "output": ["0\n"]}, {"input": "100 29 51 667663580\n", "output": ["0\n"]}, {"input": "100 30 70 10648221\n", "output": ["0\n"]}, {"input": "100 77 65 984750163\n", "output": ["0\n"]}, {"input": "100 50 28 647161803\n", "output": ["24621498\n"]}, {"input": "79 13 14 531408605\n", "output": ["186854520\n"]}, {"input": "9 4 1 765062520\n", "output": ["66112\n"]}, {"input": "100 40 32 976432512\n", "output": ["79377408\n"]}, {"input": "100 25 41 342159999\n", "output": ["0\n"]}, {"input": "100 51 26 772413287\n", "output": ["82875291\n"]}, {"input": "100 57 48 171736091\n", "output": ["0\n"]}, {"input": "100 31 34 148365334\n", "output": ["71342466"]}, {"input": "87 24 38 269164991\n", "output": ["0"]}, {"input": "99 30 18 3\n", "output": ["2"]}, {"input": "60 13 17 176391848\n", "output": ["30875872"]}, {"input": "67 20 17 662420638\n", "output": ["525007894"]}, {"input": "68 36 9 855650468\n", "output": ["756405948"]}, {"input": "100 32 24 48351440\n", "output": ["44494240"]}, {"input": "49 9 14 308312578\n", "output": ["219544054"]}, {"input": "54 10 3 221451100\n", "output": ["95556052"]}, {"input": "87 25 12 933725311\n", "output": ["621828261"]}, {"input": "100 44 16 28930735\n", "output": ["7701663"]}, {"input": "18 4 4 373700054\n", "output": ["181519114"]}, {"input": "100 43 28 19087607\n", "output": ["9304493"]}, {"input": "96 25 23 27001494\n", "output": ["7018470"]}, {"input": "100 54 3 714405093\n", "output": ["516734541"]}, {"input": "81 21 14 695031561\n", "output": ["328097426"]}, {"input": "34 18 3 198747828\n", "output": ["171829012"]}, {"input": "74 19 21 748555616\n", "output": ["616966592"]}, {"input": "79 13 28 531408605\n", "output": ["495254155"]}, {"input": "9 7 1 765062520\n", "output": ["31936"]}, {"input": "100 40 32 986726587\n", "output": ["592819392"]}, {"input": "66 11 4 786747482\n", "output": ["569232480"]}, {"input": "100 31 34 177956807\n", "output": ["158289165"]}, {"input": "82 13 17 176391848\n", "output": ["39619376"]}, {"input": "67 20 17 93649925\n", "output": ["43482390"]}, {"input": "100 32 4 48351440\n", "output": ["16771904"]}, {"input": "49 9 20 308312578\n", "output": ["219881016"]}, {"input": "54 15 3 221451100\n", "output": ["116620024"]}, {"input": "87 47 12 933725311\n", "output": ["724371673"]}, {"input": "100 44 16 27012826\n", "output": ["26617988"]}, {"input": "100 43 28 298638\n", "output": ["215892"]}, {"input": "96 25 23 49995734\n", "output": ["14150658"]}, {"input": "100 54 1 714405093\n", "output": ["479969343"]}, {"input": "81 21 20 695031561\n", "output": ["418485426"]}, {"input": "34 18 4 198747828\n", "output": ["177768488"]}, {"input": "74 24 21 748555616\n", "output": ["650100000"]}, {"input": "79 15 28 531408605\n", "output": ["192334135"]}, {"input": "66 19 4 786747482\n", "output": ["496418370"]}, {"input": "100 21 34 177956807\n", "output": ["118611254"]}, {"input": "82 13 17 292697502\n", "output": ["178787478"]}, {"input": "67 10 17 93649925\n", "output": ["82065480"]}, {"input": "49 13 20 308312578\n", "output": ["188217438"]}, {"input": "21 15 3 221451100\n", "output": ["138272532"]}, {"input": "87 47 12 77289701\n", "output": ["30688417"]}, {"input": "100 43 28 130177\n", "output": ["66642"]}, {"input": "96 25 26 49995734\n", "output": ["47547394"]}, {"input": "100 48 12 618540992\n", "output": ["447292160"]}, {"input": "81 30 20 695031561\n", "output": ["605834658"]}, {"input": "34 18 7 198747828\n", "output": ["14011120"]}, {"input": "16 7 1 1104473567\n", "output": ["408899597"]}, {"input": "66 19 6 786747482\n", "output": ["697212740"]}, {"input": "82 13 17 57728977\n", "output": ["2727690"]}, {"input": "67 14 17 93649925\n", "output": ["67923755"]}, {"input": "49 12 20 308312578\n", "output": ["67357264"]}, {"input": "21 15 4 221451100\n", "output": ["56666076"]}, {"input": "87 43 12 77289701\n", "output": ["22449566"]}, {"input": "96 12 26 49995734\n", "output": ["6768858"]}, {"input": "100 48 12 1019549242\n", "output": ["27112648"]}, {"input": "34 18 7 187253483\n", "output": ["149660679"]}, {"input": "16 7 2 1104473567\n", "output": ["260414618"]}, {"input": "66 19 3 786747482\n", "output": ["321045330"]}, {"input": "67 14 17 65236350\n", "output": ["2572530"]}, {"input": "49 12 20 289861624\n", "output": ["49469992"]}, {"input": "21 15 4 240568600\n", "output": ["185729376"]}, {"input": "96 12 31 49995734\n", "output": ["37948714"]}, {"input": "34 18 0 187253483\n", "output": ["157009770"]}, {"input": "16 9 2 1104473567\n", "output": ["390291587"]}, {"input": "66 19 3 986850954\n", "output": ["703901536"]}, {"input": "67 14 17 121944007\n", "output": ["47290188"]}, {"input": "49 12 20 540045319\n", "output": ["108901804"]}, {"input": "36 15 4 240568600\n", "output": ["97704168"]}, {"input": "96 11 31 49995734\n", "output": ["32575262"]}, {"input": "40 18 0 187253483\n", "output": ["164192774"]}, {"input": "100 81 3 493523592\n", "output": ["204556824"]}, {"input": "40 19 3 986850954\n", "output": ["167749686"]}, {"input": "67 14 17 145753644\n", "output": ["102141600"]}, {"input": "36 15 1 240568600\n", "output": ["34087328"]}, {"input": "87 25 12 77289701\n", "output": ["18979863"]}, {"input": "100 81 0 493523592\n", "output": ["450587744"]}, {"input": "49 19 3 986850954\n", "output": ["889195754"]}, {"input": "46 14 17 145753644\n", "output": ["52696668"]}, {"input": "36 18 1 240568600\n", "output": ["136986160"]}, {"input": "87 18 12 77289701\n", "output": ["39102988"]}, {"input": "100 81 1 493523592\n", "output": ["282525328"]}, {"input": "46 14 17 52540392\n", "output": ["30501960"]}, {"input": "36 18 1 291153326\n", "output": ["98909946"]}, {"input": "87 18 9 77289701\n", "output": ["57739169"]}, {"input": "46 13 17 52540392\n", "output": ["620112"]}, {"input": "36 10 1 291153326\n", "output": ["45261388"]}, {"input": "87 18 9 148860245\n", "output": ["75645813"]}, {"input": "46 13 18 52540392\n", "output": ["46453008"]}, {"input": "36 10 2 291153326\n", "output": ["104090786"]}, {"input": "46 13 18 30407390\n", "output": ["15295410"]}, {"input": "38 10 2 291153326\n", "output": ["156554784"]}, {"input": "16 6 5 5\n", "output": ["1"]}, {"input": "38 13 2 291153326\n", "output": ["201505506"]}, {"input": "38 13 2 140784535\n", "output": ["93763114"]}, {"input": "38 13 2 23942850\n", "output": ["15031844"]}, {"input": "38 13 1 23942850\n", "output": ["17757182"]}, {"input": "38 13 2 3676263\n", "output": ["874610"]}, {"input": "38 13 0 3676263\n", "output": ["3080310"]}, {"input": "38 18 0 3676263\n", "output": ["2819762"]}, {"input": "52 18 0 3676263\n", "output": ["1154343"]}, {"input": "52 18 1 3676263\n", "output": ["1476943"]}, {"input": "18 18 1 3676263\n", "output": ["131072"]}, {"input": "19 9 4 261612\n", "output": ["80104"]}, {"input": "19 14 4 261612\n", "output": ["24156"]}, {"input": "19 14 2 261612\n", "output": ["246644"]}, {"input": "19 14 1 261612\n", "output": ["87628"]}, {"input": "19 14 1 126669\n", "output": ["13099"]}, {"input": "19 1 1 126669\n", "output": ["79365"]}, {"input": "19 2 1 126669\n", "output": ["15021"]}, {"input": "19 1 1 82018\n", "output": ["23648"]}, {"input": "28 1 1 82018\n", "output": ["36708"]}, {"input": "54 1 1 82018\n", "output": ["60674"]}, {"input": "54 1 1 65770\n", "output": ["49870"]}, {"input": "54 1 1 75791\n", "output": ["68856"]}, {"input": "100 31 30 214796854\n", "output": ["23932048"]}, {"input": "99 30 18 9\n", "output": ["8"]}, {"input": "60 19 17 104779386\n", "output": ["71768412"]}, {"input": "100 37 30 498388229\n", "output": ["217650603"]}, {"input": "75 36 6 855650468\n", "output": ["525655356"]}, {"input": "75 15 14 308312578\n", "output": ["223154810"]}, {"input": "89 12 15 106840615\n", "output": ["16613523"]}, {"input": "72 10 15 221451100\n", "output": ["201447716"]}, {"input": "100 25 29 164834266\n", "output": ["26557830"]}, {"input": "96 21 21 992859620\n", "output": ["765062648"]}, {"input": "100 44 30 988511794\n", "output": ["482304904"]}, {"input": "18 4 4 341396382\n", "output": ["135513762"]}, {"input": "96 41 23 965938339\n", "output": ["108078872"]}, {"input": "81 6 14 695031561\n", "output": ["30090834"]}, {"input": "34 11 3 198747828\n", "output": ["159079032"]}, {"input": "100 50 28 931584837\n", "output": ["658982070"]}, {"input": "9 4 2 765062520\n", "output": ["203360"]}, {"input": "100 25 12 342159999\n", "output": ["40202793"]}, {"input": "7 4 1 769626776\n", "output": ["2624"]}, {"input": "66 11 9 502080449\n", "output": ["250847261"]}, {"input": "100 31 24 148365334\n", "output": ["80008890"]}, {"input": "60 16 17 176391848\n", "output": ["137534984"]}, {"input": "61 20 17 662420638\n", "output": ["236687066"]}, {"input": "68 36 6 855650468\n", "output": ["641455616"]}, {"input": "100 32 24 42949732\n", "output": ["39077984"]}, {"input": "49 9 14 217935696\n", "output": ["199577952"]}, {"input": "64 10 3 221451100\n", "output": ["147699660"]}, {"input": "100 67 16 28930735\n", "output": ["25064350"]}, {"input": "18 4 2 373700054\n", "output": ["212509070"]}, {"input": "96 25 23 32520448\n", "output": ["12212224"]}, {"input": "100 54 3 383503842\n", "output": ["168776310"]}, {"input": "81 29 14 695031561\n", "output": ["5486256"]}, {"input": "34 18 3 109073711\n", "output": ["94874565"]}, {"input": "79 19 28 531408605\n", "output": ["433422225"]}, {"input": "100 40 32 606578883\n", "output": ["456412017"]}, {"input": "19 11 4 786747482\n", "output": ["673866014"]}, {"input": "7 3 4 10007\n", "output": ["80"]}, {"input": "92 13 17 176391848\n", "output": ["96138432"]}, {"input": "67 27 17 93649925\n", "output": ["18319675"]}, {"input": "30 4 9 157679620\n", "output": ["0"]}, {"input": "100 30 58 1064\n", "output": ["0"]}, {"input": "100 54 70 12345\n", "output": ["0"]}, {"input": "7 1 4 1064\n", "output": ["0"]}, {"input": "100 48 39 426348968\n", "output": ["0"]}, {"input": "100 57 51 667663580\n", "output": ["0"]}, {"input": "100 77 92 984750163\n", "output": ["0"]}, {"input": "100 81 28 647161803\n", "output": ["0"]}, {"input": "100 25 41 44001198\n", "output": ["0"]}, {"input": "100 57 86 171736091\n", "output": ["0"]}, {"input": "4 3 4 10007\n", "output": ["0"]}, {"input": "99 30 18 6\n", "output": ["2"]}, {"input": "30 4 17 157679620\n", "output": ["0"]}, {"input": "68 57 9 855650468\n", "output": ["0"]}, {"input": "100 54 70 8938\n", "output": ["0"]}, {"input": "18 4 0 373700054\n", "output": ["0"]}, {"input": "7 1 4 1423\n", "output": ["0"]}, {"input": "100 48 39 618540992\n", "output": ["0"]}, {"input": "100 77 49 984750163\n", "output": ["0"]}, {"input": "100 81 28 391157626\n", "output": ["0"]}, {"input": "9 7 1 1104473567\n", "output": ["31936"]}, {"input": "100 71 32 986726587\n", "output": ["0"]}, {"input": "100 25 67 44001198\n", "output": ["0"]}, {"input": "4 6 4 10007\n", "output": ["0"]}, {"input": "73 30 18 6\n", "output": ["0"]}, {"input": "30 2 17 157679620\n", "output": ["0"]}, {"input": "100 10 70 8938\n", "output": ["0"]}, {"input": "25 4 0 373700054\n", "output": ["0"]}, {"input": "100 77 60 984750163\n", "output": ["0"]}, {"input": "100 81 25 391157626\n", "output": ["0"]}, {"input": "100 71 32 837920002\n", "output": ["0"]}, {"input": "100 25 87 44001198\n", "output": ["0"]}, {"input": "4 6 4 2672\n", "output": ["0"]}, {"input": "73 30 7 6\n", "output": ["0"]}, {"input": "100 10 70 16755\n", "output": ["0"]}, {"input": "25 4 0 418575380\n", "output": ["0"]}, {"input": "100 67 28 130177\n", "output": ["0"]}, {"input": "100 77 17 984750163\n", "output": ["0"]}, {"input": "100 81 25 481298326\n", "output": ["0"]}, {"input": "100 71 32 198736276\n", "output": ["0"]}, {"input": "4 6 4 11\n", "output": ["0"]}, {"input": "100 12 70 16755\n", "output": ["0"]}, {"input": "87 70 12 77289701\n", "output": ["0"]}, {"input": "25 4 0 157204656\n", "output": ["0"]}], "source_codes": ["\nimport sys\ninput = sys.stdin.read\n\nMOD = 10**9 + 7\n\ndef main():\n    data = input().split()\n    n = int(data[0])\n    m = int(data[1])\n    k = int(data[2])\n    p = int(data[3])\n\n    # dp[i][j] = number of permutations of length i with exactly j good numbers\n    dp = [[0] * (k + 1) for _ in range(n + 1)]\n    dp[0][0] = 1\n\n    for i in range(1, n + 1):\n        for j in range(k + 1):\n            # Place the number i in the permutation\n            # The number i can be a good number if it has exactly m different maxima on subsegments\n            # We need to count how many ways to place i such that it becomes a good number\n            if j > 0:\n                dp[i][j] = (dp[i][j] + dp[i - 1][j - 1]) % p\n\n            # The number i can be placed in a way that it is not a good number\n            dp[i][j] = (dp[i][j] + dp[i - 1][j] * (i - 1)) % p\n\n    print(dp[n][k] % p)\n\nmain()\n\n\n"], "responses": ["```python\nimport sys\ninput = sys.stdin.read\n\nMOD = 10**9 + 7\n\ndef main():\n    data = input().split()\n    n = int(data[0])\n    m = int(data[1])\n    k = int(data[2])\n    p = int(data[3])\n\n    # dp[i][j] = number of permutations of length i with exactly j good numbers\n    dp = [[0] * (k + 1) for _ in range(n + 1)]\n    dp[0][0] = 1\n\n    for i in range(1, n + 1):\n        for j in range(k + 1):\n            # Place the number i in the permutation\n            # The number i can be a good number if it has exactly m different maxima on subsegments\n            # We need to count how many ways to place i such that it becomes a good number\n            if j > 0:\n                dp[i][j] = (dp[i][j] + dp[i - 1][j - 1]) % p\n\n            # The number i can be placed in a way that it is not a good number\n            dp[i][j] = (dp[i][j] + dp[i - 1][j] * (i - 1)) % p\n\n    print(dp[n][k] % p)\n\nmain()\n```"], "prompt_tokens": [2876], "completion_tokens": [292], "no_of_try": 1, "is_solved": false, "language": "Python3", "task_id": 1580}
